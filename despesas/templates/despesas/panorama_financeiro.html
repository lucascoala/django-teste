{% extends 'paginas/modelo.html' %}
{% load static %}


{% block conteudo %}
<div class="container-fluid">
    <h2 class="text-center mb-4">Panorama Financeiro - {{ mes_atual }} {{ ano_atual }}</h2>

    <!-- Filtros -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" class="form-inline justify-content-center">
                <div class="form-group mx-2">
                    <label class="mr-2">Mês:</label>
                    <select name="mes" class="form-control">
                        {% for i in "123456789101112"|make_list %}
                        <option value="{{ i }}" {% if i|stringformat:"i" == mes_atual|stringformat:"i" %}selected{% endif %}>
                            {{ i }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group mx-2">
                    <label class="mr-2">Ano:</label>
                    <select name="ano" class="form-control">
                        {% for ano in anos_disponiveis %}
                        <option value="{{ ano }}" {% if ano == ano_atual %}selected{% endif %}>
                            {{ ano }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Filtrar</button>
            </form>
        </div>
    </div>

    <!-- Resumo -->
    <div class="row">
        <div class="col-md-4">
            <div class="card text-white bg-success mb-4">
                <div class="card-body">
                    <h5 class="card-title">Total de Entradas</h5>
                    <p class="card-text h3">R$ {{ total_contribuicoes|floatformat:2 }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-danger mb-4">
                <div class="card-body">
                    <h5 class="card-title">Total de Saídas</h5>
                    <p class="card-text h3">R$ {{ total_despesas|floatformat:2 }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card {% if saldo >= 0 %}text-white bg-primary{% else %}text-white bg-warning{% endif %} mb-4">
                <div class="card-body">
                    <h5 class="card-title">Saldo</h5>
                    <p class="card-text h3">R$ {{ saldo|floatformat:2 }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Despesas por Categoria -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">Despesas por Categoria</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>CLC</th>
                            <th>Descrição</th>
                            <th>Quantidade</th>
                            <th>Valor</th>
                            <th>Percentual</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for categoria in despesas_por_categoria %}
                        <tr>
                            <td>{{ categoria.clc }}</td>
                            <td>{{ categoria.descricao }}</td>
                            <td>{{ categoria.quantidade }}</td>
                            <td>R$ {{ categoria.total|floatformat:2 }}</td>
                            <td>{{ categoria.percentual|floatformat:1 }}%</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr class="table-info">
                            <td colspan="3"><strong>Total</strong></td>
                            <td><strong>R$ {{ total_despesas|floatformat:2 }}</strong></td>
                            <td><strong>100%</strong></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <!-- Próximas Despesas -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Próximas Despesas</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Descrição</th>
                                    <th>Vencimento</th>
                                    <th>Valor</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for despesa in proximas_despesas %}
                                <tr>
                                    <td>{{ despesa.descricao }}</td>
                                    <td>{{ despesa.data_vencimento }}</td>
                                    <td>R$ {{ despesa.valor|floatformat:2 }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Histórico dos Últimos 6 Meses</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Mês</th>
                                    <th>Entradas</th>
                                    <th>Saídas</th>
                                    <th>Saldo</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for mes in historico %}
                                <tr>
                                    <td>{{ mes.mes }}</td>
                                    <td class="text-success">R$ {{ mes.contribuicoes|floatformat:2 }}</td>
                                    <td class="text-danger">R$ {{ mes.despesas|floatformat:2 }}</td>
                                    <td class="{% if mes.saldo >= 0 %}text-primary{% else %}text-warning{% endif %}">
                                        R$ {{ mes.saldo|floatformat:2 }}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}